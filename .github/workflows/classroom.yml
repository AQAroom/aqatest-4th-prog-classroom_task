name: Autograding Tests
'on':
  - push
  - repository_dispatch
permissions:
  checks: write
  actions: read
  contents: read
jobs:
  run-autograding-tests:
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    # Ð¢ÐµÑÑ‚Ñ‹ Ñ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ ID Ð´Ð»Ñ ÑÐ±Ð¾Ñ€Ð° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð²
    - name: Ð¡Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
      id: add_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Ð¡Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
        command: python task.py
        input: |
          5
          +
          3
        expected-output: '8'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: Ð’Ñ‹Ñ‡Ð¸Ñ‚Ð°Ð½Ð¸Ðµ
      id: sub_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Ð’Ñ‹Ñ‡Ð¸Ñ‚Ð°Ð½Ð¸Ðµ
        command: python task.py
        input: |
          10
          -
          4
        expected-output: '6'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: Ð£Ð¼Ð½Ð¾Ð¶ÐµÐ½Ð¸Ðµ
      id: mul_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Ð£Ð¼Ð½Ð¾Ð¶ÐµÐ½Ð¸Ðµ
        command: python task.py
        input: |
          7
          *
          6
        expected-output: '42'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: Ð”ÐµÐ»ÐµÐ½Ð¸Ðµ
      id: div_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Ð”ÐµÐ»ÐµÐ½Ð¸Ðµ
        command: python task.py
        input: |
          15
          /
          3
        expected-output: '5'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: Ð¡Ñ‚ÐµÐ¿ÐµÐ½ÑŒ
      id: pow_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Ð¡Ñ‚ÐµÐ¿ÐµÐ½ÑŒ
        command: python task.py
        input: |
          2
          **
          3
        expected-output: '8'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: Ð”ÐµÐ»ÐµÐ½Ð¸Ðµ Ð½Ð° Ð½Ð¾Ð»ÑŒ
      id: div_zero_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: Ð”ÐµÐ»ÐµÐ½Ð¸Ðµ Ð½Ð° Ð½Ð¾Ð»ÑŒ
        setup-command: 'div-2-zero'
        command: python task.py
        input: |
          10
          /
          0
        expected-output: error
        comparison-method: contains
        timeout: 5
        max-score: 15
    
    - name: ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ
      id: unk_test
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ
        command: python task.py
        input: |
          5
          %
          3
        expected-output: Ð½ÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ
        comparison-method: contains
        timeout: 5
        max-score: 10
    
    - name: Autograding Reporter
      id: reporter
      uses: classroom-resources/autograding-grading-reporter@v1
      env:
        ADD_RESULTS: "${{steps.add_test.outputs.result}}"
        SUB_RESULTS: "${{steps.sub_test.outputs.result}}"
        MUL_RESULTS: "${{steps.mul_test.outputs.result}}"
        DIV_RESULTS: "${{steps.div_test.outputs.result}}"
        POW_RESULTS: "${{steps.pow_test.outputs.result}}"
        DIV_ZERO_SCORE: "${{ steps.div_zero_test.outputs.result }}"
        UNK_RESULTS: "${{steps.unk_test.outputs.result}}"
      with:
        runners: add_test,sub_test,mul_test,div_test,pow_test,div_zero_test,unk_test
    
    - name: Generate Summary
      run: |
        # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¾Ð±Ñ‰Ð¸Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¸Ð· reporter
        TOTAL_POINTS="${{ steps.reporter.outputs.totalPoints || 100 }}"
        MAX_POINTS="${{ steps.reporter.outputs.maxPoints || 100 }}"
        
        # Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¸Ð· ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ñ‚ÐµÑÑ‚Ð°
        ADD_SCORE="${{ steps.add_test.outputs.score || 15 }}"
        SUB_SCORE="${{ steps.sub_test.outputs.score || 15 }}"
        MUL_SCORE="${{ steps.mul_test.outputs.score || 15 }}"
        DIV_SCORE="${{ steps.div_test.outputs.score || 15 }}"
        POW_SCORE="${{ steps.pow_test.outputs.score || 15 }}"
        DIV_ZERO_SCORE="${{ steps.div_zero_test.outputs.score || 15 }}"
        UNKNOWN_SCORE="${{ steps.unk_test.outputs.score || 10 }}"
        
        # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹ (Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð²ÑÐµ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ñ‹)
        ADD_STATUS="âœ…"
        SUB_STATUS="âœ…"
        MUL_STATUS="âœ…"
        DIV_STATUS="âœ…"
        POW_STATUS="âœ…"
        DIV_ZERO_STATUS="âœ…"
        UNKNOWN_STATUS="âœ…"
        
        echo "## ðŸ“Š Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ§ª Ð”ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‚ÐµÑÑ‚Ð¾Ð²" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| Ð¢ÐµÑÑ‚ | Ð‘Ð°Ð»Ð»Ñ‹ | ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ | Ð¡Ñ‚Ð°Ñ‚ÑƒÑ |" >> $GITHUB_STEP_SUMMARY
        echo "|------|-------|----------|--------|" >> $GITHUB_STEP_SUMMARY
        echo "| **Ð¡Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ** | $ADD_SCORE | 15 | $ADD_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **Ð’Ñ‹Ñ‡Ð¸Ñ‚Ð°Ð½Ð¸Ðµ** | $SUB_SCORE | 15 | $SUB_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **Ð£Ð¼Ð½Ð¾Ð¶ÐµÐ½Ð¸Ðµ** | $MUL_SCORE | 15 | $MUL_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **Ð”ÐµÐ»ÐµÐ½Ð¸Ðµ** | $DIV_SCORE | 15 | $DIV_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **Ð¡Ñ‚ÐµÐ¿ÐµÐ½ÑŒ** | $POW_SCORE | 15 | $POW_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **Ð”ÐµÐ»ÐµÐ½Ð¸Ðµ Ð½Ð° Ð½Ð¾Ð»ÑŒ** | $DIV_ZERO_SCORE | 15 | $DIV_ZERO_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ** | $UNKNOWN_SCORE | 10 | $UNKNOWN_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # Ð Ð°ÑÑ‡ÐµÑ‚ Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚Ð°
        PERCENTAGE=$((TOTAL_POINTS * 100 / MAX_POINTS))
        
        echo "### ðŸ† Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Ð’ÑÐµÐ³Ð¾ Ð±Ð°Ð»Ð»Ð¾Ð²:** $TOTAL_POINTS / $MAX_POINTS" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ-Ð±Ð°Ñ€
        echo "**ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ:**" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "<div style='background: #e1e4e8; border-radius: 4px; height: 20px; width: 100%;'>" >> $GITHUB_STEP_SUMMARY
        echo "  <div style='background: #2ea44f; border-radius: 4px; height: 100%; width: $PERCENTAGE%;'></div>" >> $GITHUB_STEP_SUMMARY
        echo "</div>" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°
        if [ "$TOTAL_POINTS" -eq "$MAX_POINTS" ]; then
          echo "ðŸŽ‰ **ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð°Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°! Ð’ÑÐµ Ñ‚ÐµÑÑ‚Ñ‹ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ñ‹!**" >> $GITHUB_STEP_SUMMARY
        elif [ "$PERCENTAGE" -ge 80 ]; then
          echo "ðŸ‘ **Ð¥Ð¾Ñ€Ð¾ÑˆÐ¸Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚! ÐŸÐ¾Ñ‡Ñ‚Ð¸ Ð²ÑÐµ Ñ‚ÐµÑÑ‚Ñ‹ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ñ‹.**" >> $GITHUB_STEP_SUMMARY
        elif [ "$PERCENTAGE" -ge 60 ]; then
          echo "âš ï¸ **Ð•ÑÑ‚ÑŒ Ð½Ð°Ð´ Ñ‡ÐµÐ¼ Ð¿Ð¾Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ.**" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ **ÐÑƒÐ¶Ð½Ð¾ ÑÐµÑ€ÑŒÐµÐ·Ð½Ð¾ Ð¿Ð¾Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð½Ð°Ð´ Ð·Ð°Ð´Ð°Ð½Ð¸ÐµÐ¼.**" >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "*ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°*" >> $GITHUB_STEP_SUMMARY
